schema: '2.0'
stages:
  01_load_data:
    cmd: python src/01_load_and_save.py --config=params.yaml
    deps:
    - path: src/01_load_and_save.py
      md5: 115aa2a3f5528eb5a03d34257caf1892
      size: 2116
    params:
      params.yaml:
        s3_data_source.bucket_folder_name: waffer_batch_files
        s3_data_source.bucket_name: wafferbucket
        s3_data_source.region_name: ap-south-1
        s3_data_source.s3_folder_list:
        - waffer_batch_files
        s3_data_source.s3_root_folder_prefix: waffer
    outs:
    - path: artifacts/waffer_batch_files
      md5: e56894b0812b99797276021d14dbaf75.dir
      size: 13625126
      nfiles: 41
  02_validation:
    cmd: python src/02_validation.py --config=params.yaml --schema=schema.yaml
    deps:
    - path: artifacts/waffer_batch_files
      md5: e56894b0812b99797276021d14dbaf75.dir
      size: 13625126
      nfiles: 41
    - path: src/02_validation.py
      md5: 9a34ef51a66d6f2ec7be4c6d62a8cd5d
      size: 6024
    params:
      params.yaml:
        artifacts.02_validation.bad_files_dir: artifacts/02_validation/bad_files
        artifacts.02_validation.good_files_dir: artifacts/02_validation/good_files
        artifacts.02_validation.s3_data_dir: artifacts/waffer_batch_files
      schema.yaml:
        LengthOfDateStampInFile: 8
        LengthOfTimeStampInFile: 6
        NumberofColumns: 592
    outs:
    - path: artifacts/02_validation/bad_files
      md5: 930fdd03dce096ddc5f3f5f3ba954977.dir
      size: 10726994
      nfiles: 32
    - path: artifacts/02_validation/good_files
      md5: afabd4473b9fadae1b2bb83b7df72e58.dir
      size: 3036137
      nfiles: 9
  03_preprocess:
    cmd: python src/03_preprocess.py --config=params.yaml
    deps:
    - path: artifacts/02_validation/good_files
      md5: afabd4473b9fadae1b2bb83b7df72e58.dir
      size: 3036137
      nfiles: 9
    - path: src/03_preprocess.py
      md5: 3a2278fd0a88255e9dc55123b37dc269
      size: 7167
    params:
      params.yaml:
        artifacts.03_preprocess.drop_0std_fname: zero_std_cols.csv
        artifacts.03_preprocess.drop_cols_fname: cols_to_drop.csv
        artifacts.03_preprocess.null_cols_fname: null_values.csv
        artifacts.03_preprocess.preprocess_dir: artifacts/03_preprocess
        artifacts.03_preprocess.preprocessed_files: artifacts/03_preprocess/preprocessed_files
        hyperparams.KNNImputer.n_neighbors: 3
        hyperparams.KNNImputer.weights: uniform
    outs:
    - path: artifacts/03_preprocess/preprocessed_files
      md5: e31766ef9fbd992c8414c63e91149244.dir
      size: 1741791
      nfiles: 2
  04_split_data:
    cmd: python src/04_split_data.py --config=params.yaml
    deps:
    - path: artifacts/03_preprocess/preprocessed_files
      md5: e31766ef9fbd992c8414c63e91149244.dir
      size: 1741791
      nfiles: 2
    - path: src/04_split_data.py
      md5: fbac06f1b855537e9dd249543ee0b278
      size: 1973
    params:
      params.yaml:
        artifacts.04_split_data.split_data_dir: artifacts/04_split_data
        base.random_state:
        - 34
        base.test_size: 0.2
    outs:
    - path: artifacts/04_split_data/X_test.csv
      md5: b5a7bb5c8b6d85362d6c85c6f338e20d
      size: 347870
    - path: artifacts/04_split_data/X_train.csv
      md5: 0f18d6f8bd47e7e2d99a11e458c7a04f
      size: 1379069
    - path: artifacts/04_split_data/Y_test.csv
      md5: c8d3cd8e951b560777ec8ce3c0be7ba9
      size: 507
    - path: artifacts/04_split_data/Y_train.csv
      md5: cd624b8fa97a5a20b4e47266ce64b961
      size: 2007
  05_train:
    cmd: python src/05_train.py --config=params.yaml
    deps:
    - path: artifacts/04_split_data/X_train.csv
      md5: 0f18d6f8bd47e7e2d99a11e458c7a04f
      size: 1379069
    - path: artifacts/04_split_data/Y_train.csv
      md5: cd624b8fa97a5a20b4e47266ce64b961
      size: 2007
    - path: src/05_train.py
      md5: 11865b762deb52e9c8bbce257491193f
      size: 10977
    params:
      params.yaml:
        base.random_state:
        - 34
        hyperparams.balanced_bagging_classifer:
          model_name: bbc_model.sav
          cv: 2
          verbose: 3
          n_estimators:
          - 180
          sampling_strategy:
          - 0.25
          replacement:
          - false
        hyperparams.balanced_random_forest:
          model_name: brfc_model.sav
          cv: 2
          verbose: 3
          n_estimators:
          - 400
          criterion:
          - gini
          max_depth:
          - 2
          - 4
          - 1
          max_features:
          - auto
        hyperparams.easy_ensemble_classifier:
          model_name: eec_model.sav
          cv: 2
          verbose: 3
          n_estimators:
          - 180
          sampling_strategy:
          - 0.25
          replacement:
          - false
    outs:
    - path: artifacts/05_train
      md5: 7409e807a49a58a3444dc2b6c59838a7.dir
      size: 9544611
      nfiles: 4
  06_evaluate:
    cmd: python src/06_evaluate.py --config=params.yaml
    deps:
    - path: artifacts/05_train
      md5: 7409e807a49a58a3444dc2b6c59838a7.dir
      size: 9544611
      nfiles: 4
    - path: src/06_evaluate.py
      md5: 36844a5ca7702f3fccf748749662bba3
      size: 4362
    params:
      params.yaml:
        artifacts.06_evaluate.evaluate_on:
        - roc_auc_score
    outs:
    - path: artifacts/06_evaluate/best_model
      md5: 430378c21a27190f8544ec44b0841108.dir
      size: 838828
      nfiles: 1
    - path: artifacts/06_evaluate/results
      md5: f338e94f47a0400ddf37527f0595620b.dir
      size: 1521
      nfiles: 3
